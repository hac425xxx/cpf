#!/usr/bin/python
# -*- coding: UTF-8 -*-
import json
from cpf.protocol.network.TCPCommunicator import TCPCommunicator
from Fuzzer import Fuzzer


class TCPFuzzer(Fuzzer):
    def __init__(self, p1, p2, nomal_trans_conf, sample_path="", logseq_count=3, interval=0.01,
                 workspace=""):
        Fuzzer.__init__(self, p1, p2, TCPCommunicator, nomal_trans_conf, sample_path, logseq_count, interval,
                        workspace)


if __name__ == '__main__':
    # fuzzer = TCPFuzzer("192.168.245.131", 21, nomal_trans_conf="/fuzzer/test/conf/floatftp", interval=0)
    fuzzer = TCPFuzzer("192.168.245.131", 21, nomal_trans_conf="/fuzzer/test/conf/floatftp", interval=0)

    fuzzer.fuzz()
    #
    print fuzzer.check_vuln([{"recv": "50617373776f7264207265717569726564",
                              "send": "55555345a79e3ce101a8202020202020202120202020202020202020202020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020202020202020202045a79e3ce101a8202020202020202120202020202020202020202020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020202020202020202020202020202020202020202020e8da5ca6c679aa544826bc54ac1053dba4db6d580f98faf69d8fc03d0713efe04e9112e21bbcee9979919af7545d176460e32a4200cefbb5e92735ef496d0a22b5bb356984fd491e2ef1aa0a0ea488169b0699291cc29095efe342620181796de6014cd9f9e79490f0d5c23167c290c488ad820ba4c18913c6e40711475d71fd81d2e6221225b6265b718e5a0d399bb1d7dfc4d593689804421baff00e6bde3cd766fe07a8950ca4641898cbb75c9b87698952a90a21410fbfc0063592537a96ff7f9cecc6430f6e538d0468cc0beba9c88bc37b2f9c1261ffa8c1864c5751f4b8ee571e4cfefadb357efe375db3007664a4b43ac8c7336cb1ab419794a7a98adb4ecbab8422fbd43df09fec9720df2020b2aedf87fb45e03960606060606060606060606060606060606060606060606060602020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020606060606060606060608c51ce202020202020202020202020202020202020202020202020e8da5ca6c679aa544826bc54ac1053dba4db6d580f98faf69d8fc03d0713efe04e9112e21bbcee9979919af7545d176460e32a4200cefbb5e92735ef496d0a22b5bb356984fd491e2ef1aa0a0ea488169b0699291cc29095efe342620181796de6014cd9f9e79490f0d5c23167c290c488ad820ba4c18913c6e40711475d71fd81d2e6221225b6265b718e5a0d399bb1d7dfc4d593689804421baff00e6bde3cd766fe07a8950ca4641898cbb75c9b87698952a90a21410fbfc0063592537a96ff7f9cecc6430f6e538d0468cc0beba9c88bc37b2f9c1261ffa8c1864c5751f4b8ee571e4cfefadb357efe375db3007664a4b43ac8c7336cb1ab419794a7a98adb4ecbab8422fbd43df09fec9720df2020b2aedf87fb45e03960606060606060606060606060606060606060606060606060602020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020606060606060606060608c51ce2020202020202020202020202020202020202020202020202020"}]
                            )
    exit(0)

    maybe_crash_seqs = [[{"recv": "50617373776f7264207265717569726564",
                          "send": "55555345a79e3ce101a8202020202020202120202020202020202020202020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020202020202020202045a79e3ce101a8202020202020202120202020202020202020202020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020202020202020202020202020202020202020202020e8da5ca6c679aa544826bc54ac1053dba4db6d580f98faf69d8fc03d0713efe04e9112e21bbcee9979919af7545d176460e32a4200cefbb5e92735ef496d0a22b5bb356984fd491e2ef1aa0a0ea488169b0699291cc29095efe342620181796de6014cd9f9e79490f0d5c23167c290c488ad820ba4c18913c6e40711475d71fd81d2e6221225b6265b718e5a0d399bb1d7dfc4d593689804421baff00e6bde3cd766fe07a8950ca4641898cbb75c9b87698952a90a21410fbfc0063592537a96ff7f9cecc6430f6e538d0468cc0beba9c88bc37b2f9c1261ffa8c1864c5751f4b8ee571e4cfefadb357efe375db3007664a4b43ac8c7336cb1ab419794a7a98adb4ecbab8422fbd43df09fec9720df2020b2aedf87fb45e03960606060606060606060606060606060606060606060606060602020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020606060606060606060608c51ce202020202020202020202020202020202020202020202020e8da5ca6c679aa544826bc54ac1053dba4db6d580f98faf69d8fc03d0713efe04e9112e21bbcee9979919af7545d176460e32a4200cefbb5e92735ef496d0a22b5bb356984fd491e2ef1aa0a0ea488169b0699291cc29095efe342620181796de6014cd9f9e79490f0d5c23167c290c488ad820ba4c18913c6e40711475d71fd81d2e6221225b6265b718e5a0d399bb1d7dfc4d593689804421baff00e6bde3cd766fe07a8950ca4641898cbb75c9b87698952a90a21410fbfc0063592537a96ff7f9cecc6430f6e538d0468cc0beba9c88bc37b2f9c1261ffa8c1864c5751f4b8ee571e4cfefadb357efe375db3007664a4b43ac8c7336cb1ab419794a7a98adb4ecbab8422fbd43df09fec9720df2020b2aedf87fb45e03960606060606060606060606060606060606060606060606060602020202020202020202020202020df2020b2aedf87fb45e0396060606060606060606060606060606060606060606060606060606060606060606060608c51ce202020202020202001a82020202020202020202020606060606060606060608c51ce2020202020202020202020202020202020202020202020202020"}],
                        [{"recv": "50617373776f7264207265717569726564",
                          "send": "0037b26a32f757189469226c2bc7bcda97d60acf6a1f00cf6a1f0a1d1f4b4760af26e87c4327792bc7bcda97d60acf6a1f00cf6a1f0a1d1f4b4760af26e87c4327790a94285d621f32325d5d"}],
                        [{"recv": "50617373776f7264207265717569726564",
                          "send": "fefec9fec9e59a71ffffffffffffffffffffffffffffffffffff8080c4f5"}]]
    for seq in maybe_crash_seqs:
        if fuzzer.check_vuln(seq):
            print json.dumps(seq)
            exit(0)
